\section{Backend}

\subsection{Technologies and libraries}\label{_technologies}

\subsubsection{NodeJs}
Node.js is an open-source, cross-platform, back-end JavaScript runtime environment that runs on the V8 engine and executes JavaScript code outside a web browser. Node.js lets developers use JavaScript to write command line tools and for server-side scripting—running scripts server-side to produce dynamic web page content before the page is sent to the user's web browser. Consequently, Node.js represents a "JavaScript everywhere" paradigm, unifying web-application development around a single programming language, rather than different languages for server-side and client-side scripts.

\begin{itemize}
    \item \textbf{Used Version:} 4.2.2
\end{itemize}

\subsubsection{Typescript}
TypeScript is a programming language developed and maintained by Microsoft. It is a strict syntactical superset of JavaScript and adds optional static typing to the language. TypeScript is designed for the development of large applications and transcompiles to JavaScript.

\begin{itemize}
    \item \textbf{Used Version:} 4.2.2
\end{itemize}

\subsubsection{JSON}
JSON (JavaScript Object Notation) is an open standard file format, and data interchange format, that uses human-readable text to store and transmit data objects consisting of attribute–value pairs and array data types (or any other serializable value). It is a very common data format, with a diverse range of applications, such as serving as a replacement for XML in AJAX systems.


\subsubsection{DynamoDB}
Amazon DynamoDB is a fully managed proprietary NoSQL database service that supports key-value and document data structures and is offered by Amazon.com as part of the Amazon Web Services portfolio
\subsubsection{Npm}
npm is the package manager for the Node JavaScript platform. It puts modules in place so that node can find them, and manages dependency conflicts intelligently.
It is extremely configurable to support a wide variety of use cases. Most commonly, it is used to publish, discover, install, and develop node programs.
\subsubsection{Swagger}
Swagger is an Interface Description Language for describing RESTful APIs expressed using JSON. Swagger is used together with a set of open-source software tools to design, build, document, and use RESTful web services. Swagger includes automated documentation, code generation (into many programming languages), and test-case generation.


\subsection{Architecture}\label{_architecture}
We created a serverless and microservices oriented architecture. Each microservice is hosted in a different repository, with its own persistence layer and CI rules.
The microservices created and their respective responsabilities are:
\begin{itemize}
    \item \textbf{products}: you can find the repo \href{https://github.com/SWException/products}{here}; it provides CRUD functionalities for products management,
          like create a new product, modify an existing one, etc... It has also the responsibility to manage images associated to a product, which are
          stored in a Amazon S3 bucket;
    \item \textbf{carts}: you can find the repo \href{https://github.com/SWException/carts}{here}; it has the responsibility to manage carts of all users and guests that
          added some products to their carts. Carts are identified by the user ID (provided by Amazon Cognito), so it communicates with users microservice for each call.
          Each cart contain only an array of tuples composed by a products ID and a quantity (integer);
    \item \textbf{orders}: you can find the repo \href{https://github.com/SWException/orders}{here}; it has the responsibility to provide CRUD functionalities for orders information.
          It also has to provide API's to start and complete checkout process, communicating with Stripe to generate a payment intent;
    \item \textbf{users}: you can find the repo \href{https://github.com/SWException/users}{here}; it provide the functionality to check a Cognito's token JWT to other microservices.
          It also provides to the frontend service the possibility to get the customers list and details about a specific customer;
    \item \textbf{categories}: you can find the repo \href{https://github.com/SWException/categories}{here}; it provides CRUD functionalities to manage categories information.
          This is called, for example, each time that someone asks for product details to the products microservice;
    \item \textbf{taxes}: you can find the repo \href{https://github.com/SWException/taxes}{here}; it provides CRUD functionalities to manage taxes information;
    \item \textbf{addresses}: you can find the repo \href{https://github.com/SWException/addresses}{here}; it provides CRUD functionalities to manage addresses information.
\end{itemize}

\subsection{Class diagrams}\label{_classDiagram}
All services are projected with the same architectural pattern, each one has three layer:
\begin{itemize}
    \item the first contains one handler for each API defined in swagger;
    \item the second is the core and contains model logic;
    \item the third and last is the repository layer, which has the responsibility to interface the
          service with third part services, databases and other services of the backend module.
\end{itemize}
In the following paragraphs, we will present a class diagram for each service.

% ##### CLASS DIAGRAMS #####

\subsubsection{Taxes service}
\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/class-diagrams/taxes.png}
    \caption{Class UML for taxes service}
\end{figure}

\subsubsection{Categories service}
\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/class-diagrams/categories.png}
    \caption{Class UML for categories service}
\end{figure}

\subsubsection{Orders service}
\begin{figure}[H]
    \includegraphics[width=\textwidth]{res/images/class-diagrams/orders.png}
    \caption{Class UML for orders service}
\end{figure}

\subsubsection{Carts service}
\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/class-diagrams/carts.png}
    \caption{Class UML for carts service}
\end{figure}

\subsubsection{Addresses service}
\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/class-diagrams/addresses.png}
    \caption{Class UML for addresses service}
\end{figure}

\subsubsection{Products service}
\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/class-diagrams/products.png}
    \caption{Class UML for products service}
\end{figure}

\subsubsection{Users service}
\begin{figure}[H]
    \includegraphics[width=0.45\textwidth]{res/images/class-diagrams/users.png}
    \caption{Class UML for users service}
\end{figure}

% #### SEQUENCE DIAGRAMS #######

\subsection{Sequence diagrams} \label{_sequenceDiagram}
In this section we'll provide sequence diagrams for explaining how microservices communicate between one each others when API's are called from the frontend service.

\subsubsection{Taxes service}
\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/taxes/createTax.png}
    \caption{Sequence diagram for createTax API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/taxes/getTax.png}
    \caption{Sequence diagram for getTax API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.8\textwidth]{res/images/sequence-diagrams/taxes/getTaxes.png}
    \caption{Sequence diagram for getTaxes API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.8\textwidth]{res/images/sequence-diagrams/taxes/updateTax.png}
    \caption{Sequence diagram for updateTax API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/taxes/deleteTax.png}
    \caption{Sequence diagram for deleteTax API}
\end{figure}

\subsubsection{Categories service}
\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/categories/createCategory.png}
    \caption{Sequence diagram for createCategory API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.8\textwidth]{res/images/sequence-diagrams/categories/getCategories.png}
    \caption{Sequence diagram for getCategories API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/categories/removeCategory.png}
    \caption{Sequence diagram for removeCategory API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/categories/updateCategory.png}
    \caption{Sequence diagram for updateCategory API}
\end{figure}

\subsubsection{Orders service}
\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/orders/getOrderByID.png}
    \caption{Sequence diagram for getOrderByID API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/orders/startCheckout.png}
    \caption{Sequence diagram for startCheckout API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/orders/completeCheckout.png}
    \caption{Sequence diagram for completeCheckout API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/orders/cancelCheckout.png}
    \caption{Sequence diagram for cancelCheckout API}
\end{figure}

\subsubsection{Carts service}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/carts/addToCart.png}
    \caption{Sequence diagram for addToCart API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/carts/deleteCart.png}
    \caption{Sequence diagram for deleteCart API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/carts/getCart.png}
    \caption{Sequence diagram for getCart API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/carts/removeFromCart.png}
    \caption{Sequence diagram for removeFromCart API}
\end{figure}

\subsubsection{Addresses service}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/addresses/getAddresses.png}
    \caption{Sequence diagram for getAddresses API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/addresses/insertAddress.png}
    \caption{Sequence diagram for insertAddress API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/addresses/removeAddress.png}
    \caption{Sequence diagram for removeAddress API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/addresses/updateAddress.png}
    \caption{Sequence diagram for updateAddress API}
\end{figure}


\subsubsection{Products service}
\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/products/getPDP.png}
    \caption{Sequence diagram for getPDP API}
\end{figure}


\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/products/getProducts.png}
    \caption{Sequence diagram for getProducts API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/products/editProduct.png}
    \caption{Sequence diagram for editProduct API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/products/createProduct.png}
    \caption{Sequence diagram for createProduct API}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/products/removeProduct.png}
    \caption{Sequence diagram for removeProduct API}
\end{figure}


\subsubsection{Users service}
\begin{figure}[H]
    \includegraphics[width=0.9\textwidth]{res/images/sequence-diagrams/users/checkCustomer.png}
    \caption{Sequence diagram for checkCustomer API}
\end{figure}
